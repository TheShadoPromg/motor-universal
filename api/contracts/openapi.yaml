openapi: 3.0.3
info:
  title: Motor Predictivo Universal API
  version: "1.0.0"
servers:
  - url: http://localhost:8080
paths:
  /predict/{fecha}:
    get:
      summary: Distribución 00–99 del día con desglose por capas
      parameters:
        - name: fecha
          in: path
          required: true
          schema: { type: string, format: date }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrediccionDia'
  /diagnostics/{fecha}:
    get:
      summary: Métricas del día (logloss, brier, ece, DAP, ES, DI, clase)
      parameters:
        - { name: fecha, in: path, required: true, schema: { type: string, format: date } }
      responses:
        "200":
          description: OK
          content: { application/json: { schema: { $ref: '#/components/schemas/DiagnosticoDia' } } }
  /explain/{fecha}/{numero}:
    get:
      summary: Trazabilidad completa de un número
      parameters:
        - { name: fecha, in: path, required: true, schema: { type: string, format: date } }
        - { name: numero, in: path, required: true, schema: { type: string, pattern: '^[0-9]{2}$' } }
      responses:
        "200": { description: OK, content: { application/json: { schema: { $ref: '#/components/schemas/ExplicacionNumero' } } } }
  /backtest/summary:
    get:
      summary: Resumen de backtesting (walk-forward)
      responses:
        "200": { description: OK, content: { application/json: { schema: { $ref: '#/components/schemas/BacktestSummary' } } } }
components:
  schemas:
    PrediccionDia:
      type: object
      properties:
        fecha: { type: string, format: date }
        distribucion:
          type: array
          items:
            type: object
            properties:
              numero: { type: string, pattern: '^[0-9]{2}$' }
              prob: { type: number }
              score_cruzado: { type: number }
              score_estructural: { type: number }
              score_derivado: { type: number }
              score_total: { type: number }
              tipo_convergencia: { type: string, enum: [C+E+D, C+E, C+D, E+D, C, E, D, Sin Activación] }
    DiagnosticoDia:
      type: object
      properties:
        fecha: { type: string, format: date }
        logloss: { type: number }
        brier: { type: number }
        ece: { type: number }
        DAP: { type: number }
        ES: { type: number }
        DI: { type: number }
        clase_dia: { type: string, enum: [activo, neutro, adverso] }
    ExplicacionNumero:
      type: object
      properties:
        fecha: { type: string, format: date }
        numero: { type: string }
        cruzado: { type: array, items: { type: string } }
        estructural: { type: array, items: { type: string } }
        derivado: { type: array, items: { type: string } }
    BacktestSummary:
      type: object
      properties:
        logloss: { type: number }
        brier: { type: number }
        ece: { type: number }
        lift_por_cuantil: { type: array, items: { type: number } }
